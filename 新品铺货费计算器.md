# **新品铺货费计算器 - 产品需求与开发规格说明书 (V1.4)**

## **1. 项目背景与目标**

目标：为采购/供应链部门提供一个基于局域网的 Web 工具，用于快速、标准化地计算新品铺货费用。  
核心价值：

1. **自动化**：标准通道（黄/蓝/绿）通过门店主数据自动计算门店数量，减少人工统计误差。  
2. **灵活性**：自定义通道允许用户直接输入各店型的铺货数量，适应非标场景。  
3. **批量化**：支持 Excel 批量导入，一次性计算成百上千个 SKU 的铺货费。  
4. **黑盒化**：前端仅输入业务条件（如“进价5元”），后端自动匹配系数。

## **2. 核心业务逻辑定义**

### **2.1 门店通道与计数逻辑**

* **数据源**：store_master.xlsx (用于标准通道的自动计数)  
* **通道定义规则**：  
  * **🟡 黄色通道**：系统自动统计（中店及以上）。  
  * **🔵 蓝色通道**：系统自动统计（成长店及以上）。  
  * **🟢 绿色通道**：系统自动统计（全部门店）。  
  * **⚪ 自定义通道**：**用户在界面/Excel上手动输入各类型门店的具体数量**。

### **2.2 基础收费与折扣逻辑**

* **基础单店收费**：根据 新品大类 和 门店类型 确定基准金额。  
* **SKU 数量折扣**：根据 同一供应商单次引进 SKU 数量 确定折扣系数。  
* **最低收费兜底**：最终计算费用若低于该品类最低标准，按最低标准收取。

### **2.3 关键系数映射逻辑**

前端输入**业务条件**，后端映射**计算系数**。

* **A. 预估实际成交综合毛利率**：区间映射  
* **B. 付款方式**：精确匹配  
* **C. 进价系数**：区间映射  
* **D. 退货条件系数**：精确匹配  
* **E. 供应商类型系数**：精确匹配

## **3. 功能界面设计 (UI/UX)**

界面采用 Streamlit 构建，分为“单品计算器”和“批量计算器”两个标签页。

### **3.1 侧边栏：全局配置**

* **门店主数据加载**：用于支持黄/蓝/绿通道的自动计算。

### **3.2 单品计算流 (Tab 1)**

* **步骤 1**: 新品大类  
* **步骤 2**: 选择通道。若选“自定义”，显示 7 个输入框。  
* **步骤 3**: 输入商务条款（毛利、进价、付款、退货、供应商）。  
* **结果**: 显示费用及明细。

### **3.3 批量计算流 (Tab 2) - 新增**

* **模板下载**: 提供标准 .xlsx 模板下载。  
* **文件上传**: 支持上传填写好的 Excel 文件。  
* **逻辑处理**:  
  * 系统逐行读取数据。  
  * **通道处理**:  
    * 若 Excel 中通道列填“自定义”，则读取该行对应的“超级旗舰店数”、“旗舰店数”等列的数值。  
    * 若填“黄色/蓝色/绿色”，则忽略具体的门店数列，直接使用系统加载的 store_master 数据进行计算。  
* **结果导出**: 输出包含“计算结果费用”和“费用说明”的新 Excel 文件。

## **4. 技术规格与数据结构**

### **4.1 核心数据文件 (Data Schema)**

#### **4.1.1 store_master.xlsx (门店基础表)**

包含字段：门店名称, 门店类型 (超级旗舰/旗舰/标准/...), 区域, 状态等。

#### **4.1.2 batch_template.xlsx (批量导入模板)**

用户上传的文件需包含以下表头：

| 字段名 | 必填 | 备注 |
| :---- | :---- | :---- |
| 商品名称 | 是 | 仅用于标识 |
| 新品大类 | 是 | 需匹配系统下拉选项 |
| SKU数 | 是 | 数字 |
| 铺货通道 | 是 | 填：黄色/蓝色/绿色/自定义 |
| 预估毛利率(%) | 是 | 数字 |
| 付款方式 | 是 | 需匹配系统下拉选项 |
| 供应商类型 | 是 | 需匹配系统下拉选项 |
| 进价 | 是 | 数字 |
| 退货条件 | 是 | 需匹配系统下拉选项 |
| (自定义)超级旗舰店数 | 否 | 仅当通道=自定义时必填 |
| (自定义)旗舰店数 | 否 | 同上 |
| ... (其他店型) | 否 | 同上 |

### **4.2 计算核心算法 (逻辑抽象)**

```python
def calculate_logic_core(row_data, store_master_df, config):  
    # 这是一个纯逻辑函数，不依赖 UI  
    # 1. 识别通道  
    if row_data['channel'] == '自定义':  
        store_counts = extract_manual_counts(row_data)  
    else:  
        store_counts = calc_auto_counts(store_master_df, row_data['channel'])  
      
    # 2. 计算系数 & 费用  
    # 使用 config 中的系数表进行查找
    # ... 
    return final_fee, fee_breakdown_str  
```

### **4.3 配置数据 (Configuration)**

系统需维护以下系数表 (建议使用 `config.yaml` 或 `coefficients.xlsx` 管理):

1.  **基础单店收费表**: {新品大类} x {门店类型} -> 基准金额
2.  **SKU数量折扣表**: {SKU数量区间} -> 折扣系数
3.  **毛利率系数表**: {毛利率区间} -> 系数A
4.  **付款方式系数表**: {付款方式} -> 系数B
5.  **进价系数表**: {进价区间} -> 系数C
6.  **退货条件系数表**: {退货条件} -> 系数D
7.  **供应商类型系数表**: {供应商类型} -> 系数E
8.  **最低收费标准**: {新品大类} -> 最低收费金额
